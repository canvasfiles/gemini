<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Simulador Interactivo: Transformación Digital</title>
<script src="https://cdn.tailwindcss.com"></script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
       body {
           font-family: 'Inter', sans-serif;
       }
       .option-card {
           transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
       }
       .option-card:hover {
           transform: translateY(-5px);
           box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
       }
       .loader {
           border: 4px solid #f3f3f3;
           border-top: 4px solid #3498db;
           border-radius: 50%;
           width: 40px;
           height: 40px;
           animation: spin 1s linear infinite;
       }
       @keyframes spin {
           0% { transform: rotate(0deg); }
           100% { transform: rotate(360deg); }
       }
</style>
</head>
<body class="bg-gray-100 text-gray-800 flex items-center justify-center min-h-screen p-4">
<div id="app" class="w-full max-w-4xl mx-auto">
<!-- Bloque para configuración de API Key en modo local -->
<div id="local-key-setup" class="hidden bg-orange-100 border-l-4 border-orange-500 text-orange-700 p-4 rounded-lg shadow-md mb-6">
<h4 class="font-bold">Nota para Uso Local (fuera de la plataforma)</h4>
<p class="text-sm">Para que la IA funcione al probar este archivo localmente, ingresa tu API Key de Google AI Studio. Esto no será visible para los alumnos en la plataforma.</p>
<div class="mt-3 flex items-center">
<input type="password" id="api-key-input" placeholder="Pega tu API Key aquí" class="w-full p-2 border border-orange-300 rounded-l-md">
<button id="save-key-btn" class="bg-orange-500 text-white font-bold px-4 py-2 rounded-r-md hover:bg-orange-600">Guardar</button>
</div>
</div>
<!-- Pantalla de Inicio -->
<div id="start-screen" class="bg-white p-8 rounded-xl shadow-lg text-center">
<h1 class="text-3xl md:text-4xl font-bold text-gray-900 mb-4">Simulador de Transformación Digital</h1>
<p class="text-lg text-gray-600 mb-6">Asume el rol de Chief Digital Officer (CDO) en "Innovatec S.A.", una empresa manufacturera tradicional. Tu misión: liderar la empresa hacia el éxito en la era digital. Enfrentarás decisiones críticas. ¿Estás listo para el desafío?</p>
<button id="start-btn" class="bg-indigo-600 text-white font-bold py-3 px-8 rounded-lg hover:bg-indigo-700 transition-colors">
               Comenzar Simulación
</button>
</div>
<!-- Pantalla de Simulación (Contenido dinámico) -->
<div id="simulation-screen" class="hidden">
<div class="bg-white p-6 md:p-8 rounded-xl shadow-lg">
<!-- Barra de Progreso -->
<div class="mb-6">
<div class="flex justify-between mb-1">
<span class="text-base font-medium text-indigo-700">Progreso</span>
<span id="progress-text" class="text-sm font-medium text-indigo-700">Paso 1 de 4</span>
</div>
<div class="w-full bg-gray-200 rounded-full h-2.5">
<div id="progress-bar" class="bg-indigo-600 h-2.5 rounded-full" style="width: 25%"></div>
</div>
</div>
<!-- Contenido de la Decisión -->
<div id="decision-content">
<h2 id="stage-title" class="text-2xl md:text-3xl font-bold text-gray-900 mb-3"></h2>
<p id="stage-scenario" class="text-gray-600 mb-8"></p>
<div id="options-container" class="grid grid-cols-1 md:grid-cols-2 gap-4">
<!-- Las opciones se insertarán aquí -->
</div>
</div>
<!-- Contenido de la Retroalimentación -->
<div id="feedback-content" class="hidden">
<h3 class="text-2xl font-bold mb-4">Retroalimentación del Asesor de IA</h3>
<div id="ai-feedback" class="bg-gray-50 p-6 rounded-lg border border-gray-200">
<!-- La retro de la IA se insertará aquí -->
</div>
<div class="text-center mt-6">
<button id="next-btn" class="bg-green-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-green-700 transition-colors hidden">Continuar</button>
<button id="retry-btn" class="bg-yellow-500 text-white font-bold py-2 px-6 rounded-lg hover:bg-yellow-600 transition-colors hidden">Intentar de Nuevo</button>
</div>
</div>
<!-- Loader -->
<div id="loader" class="hidden flex flex-col items-center justify-center p-8">
<div class="loader mb-4"></div>
<p class="text-gray-600">Consultando al asesor de IA...</p>
</div>
</div>
</div>
<!-- Pantalla Final -->
<div id="end-screen" class="hidden bg-white p-8 rounded-xl shadow-lg text-center">
<h1 class="text-3xl md:text-4xl font-bold text-green-600 mb-4">¡Felicitaciones!</h1>
<p class="text-lg text-gray-600 mb-6">Has completado con éxito la simulación y has sentado las bases para la transformación digital de Innovatec S.A. Has demostrado una gran visión estratégica. Recuerda que la transformación es un viaje continuo, no un destino.</p>
<button id="restart-btn" class="bg-indigo-600 text-white font-bold py-3 px-8 rounded-lg hover:bg-indigo-700 transition-colors">
               Reiniciar Simulación
</button>
</div>
</div>
<script>
       const simulationData = [
           {
               title: "Decisión 1: El Punto de Partida",
               scenario: "Acabas de llegar a Innovatec S.A. La presión de competidores ágiles es alta. La junta directiva espera un plan de acción. ¿Cuál debe ser tu primer movimiento estratégico para diagnosticar la situación y establecer una dirección clara?",
               options: [
                   { text: "Realizar un análisis exhaustivo de los procesos internos para encontrar eficiencias.", isOptimal: false },
                   { text: "Lanzar una encuesta masiva a los clientes para entender sus necesidades digitales.", isOptimal: false },
                   { text: "Organizar workshops con líderes de todas las áreas para crear un mapa de capacidades digitales y alinear la visión.", isOptimal: true },
                   { text: "Contratar a una consultora externa de renombre para que elabore un informe completo.", isOptimal: false }
               ]
           },
           {
               title: "Decisión 2: El Proyecto Piloto",
               scenario: "Has logrado alinear a los directivos. Ahora necesitas una victoria temprana para generar confianza y demostrar el valor de la transformación. ¿Qué proyecto piloto eliges para empezar?",
               options: [
                   { text: "Implementar un nuevo sistema ERP (Enterprise Resource Planning) para toda la compañía.", isOptimal: false },
                   { text: "Lanzar una plataforma de e-commerce para un nicho de mercado específico y medir resultados.", isOptimal: true },
                   { text: "Digitalizar completamente el archivo histórico de la empresa para mejorar la gestión documental.", isOptimal: false },
                   { text: "Crear una 'app' móvil interna para mejorar la comunicación entre empleados.", isOptimal: false }
               ]
           },
           {
               title: "Decisión 3: Gestión del Cambio",
               scenario: "El proyecto piloto de e-commerce es un éxito inicial, pero empiezas a notar resistencia y escepticismo en algunos equipos clave. Temen que la tecnología reemplace sus trabajos. ¿Cómo abordas esta resistencia cultural?",
               options: [
                   { text: "Ignorar a los detractores y enfocarse en los que sí apoyan el cambio.", isOptimal: false },
                   { text: "Establecer un programa de 'Campeones Digitales', capacitando a empleados influyentes para que lideren la adopción y comuniquen los beneficios.", isOptimal: true },
                   { text: "Hacer obligatorios cursos de capacitación sobre las nuevas herramientas para todos los empleados.", isOptimal: false },
                   { text: "Presentar un informe a la dirección sobre los empleados que no cooperan para que tomen medidas.", isOptimal: false }
               ]
           },
           {
               title: "Decisión 4: Escalando la Transformación",
               scenario: "Tu estrategia de gestión del cambio funcionó y el proyecto piloto superó las expectativas. La junta directiva ha aprobado un presupuesto mayor. ¿Cuál es el siguiente paso para escalar la transformación a toda la organización?",
               options: [
                   { text: "Crear un 'Centro de Excelencia Digital' para estandarizar las mejores prácticas y gobernar la expansión de las iniciativas.", isOptimal: true },
                   { text: "Replicar el mismo proyecto de e-commerce en cinco nuevos mercados simultáneamente.", isOptimal: false },
                   { text: "Invertir todo el nuevo presupuesto en la tecnología más avanzada de IA y machine learning que encuentres.", isOptimal: false },
                   { text: "Declarar la misión cumplida y enfocarse solo en el mantenimiento del proyecto piloto.", isOptimal: false }
               ]
           }
       ];
       let currentStage = 0;
       const startScreen = document.getElementById('start-screen');
       const simulationScreen = document.getElementById('simulation-screen');
       const endScreen = document.getElementById('end-screen');
       const localKeySetup = document.getElementById('local-key-setup');
       const apiKeyInput = document.getElementById('api-key-input');
       const saveKeyBtn = document.getElementById('save-key-btn');
       const startBtn = document.getElementById('start-btn');
       const restartBtn = document.getElementById('restart-btn');
       const nextBtn = document.getElementById('next-btn');
       const retryBtn = document.getElementById('retry-btn');
       const progressBar = document.getElementById('progress-bar');
       const progressText = document.getElementById('progress-text');
       const decisionContent = document.getElementById('decision-content');
       const feedbackContent = document.getElementById('feedback-content');
       const loader = document.getElementById('loader');
       const stageTitle = document.getElementById('stage-title');
       const stageScenario = document.getElementById('stage-scenario');
       const optionsContainer = document.getElementById('options-container');
       const aiFeedback = document.getElementById('ai-feedback');
       // --- MANEJO DE API KEY (LOCAL vs PLATAFORMA) ---
       function setupApiKey() {
           // Esta variable global la inyecta la plataforma. Si no existe, asumimos ejecución local.
           if (typeof __initial_auth_token === 'undefined') {
               const storedKey = localStorage.getItem('geminiApiKey');
               if (!storedKey) {
                   localKeySetup.classList.remove('hidden');
               }
           }
       }
       saveKeyBtn.addEventListener('click', () => {
           const key = apiKeyInput.value;
           if (key) {
               localStorage.setItem('geminiApiKey', key);
               localKeySetup.classList.add('hidden');
               alert('API Key guardada localmente para esta sesión.');
           } else {
               alert('Por favor, ingresa una API Key.');
           }
       });
       // --- FUNCIONES DE LA API DE IA ---
       async function getAIFeedback(stage, userChoice) {
           const systemPrompt = `Actúa como un experto consultor de transformación digital de nivel senior, similar a un profesor de posgrado. El usuario está en una simulación interpretando a un CDO. Proporciona retroalimentación concisa y educativa sobre la decisión que ha tomado.
           1.  Analiza la opción elegida en el contexto del escenario.
           2.  Explica claramente las ventajas y desventajas de esa elección.
           3.  Indica si es la ruta más óptima y por qué. Si no lo es, sugiere sutilmente cuál sería un enfoque más estratégico sin dar la respuesta directa.
           4.  Mantén un tono profesional, constructivo y académico. Usa un máximo de 150 palabras.`;
           const userQuery = `Escenario: "${stage.scenario}"\n\nDecisión Tomada: "${userChoice.text}"\n\nProporciona tu análisis y retroalimentación.`;
           // Si hay una key local, la usamos. Si no, dejamos la cadena vacía para que la plataforma la inyecte.
           const apiKey = localStorage.getItem('geminiApiKey') || "";
           const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
           const payload = {
               contents: [{ parts: [{ text: userQuery }] }],
               systemInstruction: {
                   parts: [{ text: systemPrompt }]
               },
           };
           let responseText = "No se pudo obtener la retroalimentación de la IA. Por favor, revisa la consola para más detalles.";
           try {
               let response;
               let retries = 3;
               let delay = 1000;
               for (let i = 0; i < retries; i++) {
                   response = await fetch(apiUrl, {
                       method: 'POST',
                       headers: { 'Content-Type': 'application/json' },
                       body: JSON.stringify(payload)
                   });
                   if (response.ok) break;
                   if (response.status === 429 || response.status >= 500) {
                       await new Promise(res => setTimeout(res, delay));
                       delay *= 2;
                   } else {
                       break;
                   }
               }
               if (!response.ok) {
                   // Si el error es 400, probablemente es por una API Key inválida en local.
                   if (response.status === 400) {
                       throw new Error(`Error en la API: ${response.status} ${response.statusText}. Si estás en modo local, verifica que tu API Key sea correcta.`);
                   }
                   throw new Error(`Error en la API: ${response.status} ${response.statusText}`);
               }
               const result = await response.json();
               const candidate = result.candidates?.[0];
               if (candidate && candidate.content?.parts?.[0]?.text) {
                   responseText = candidate.content.parts[0].text;
               } else {
                    responseText = "La respuesta de la IA no tuvo el formato esperado. Feedback por defecto: Evalúa si tu decisión promueve la colaboración y genera un impacto visible a corto plazo. Las transformaciones exitosas comienzan con victorias tempranas y un fuerte alineamiento organizacional.";
               }
           } catch (error) {
               console.error("Error al llamar a la API de Gemini:", error);
                responseText = `Error de conexión: ${error.message}. Feedback por defecto: Asegúrate de que tu elección inicial involucre a las personas clave. La transformación digital es tanto un cambio cultural como tecnológico. Una base sólida de colaboración es fundamental para el éxito.`;
           }
           return responseText.replace(/\n/g, '<br>');
       }
       // --- FUNCIONES DE LA LÓGICA DE LA SIMULACIÓN ---
       function renderStage(stageIndex) {
           const stage = simulationData[stageIndex];
           stageTitle.textContent = stage.title;
           stageScenario.textContent = stage.scenario;
           optionsContainer.innerHTML = '';
           stage.options.forEach(option => {
               const button = document.createElement('button');
               button.className = 'option-card bg-white border border-gray-200 rounded-lg p-5 text-left w-full hover:bg-indigo-50 hover:border-indigo-300 focus:outline-none focus:ring-2 focus:ring-indigo-500';
               button.innerHTML = `<p class="font-semibold text-gray-700">${option.text}</p>`;
               button.onclick = () => handleOptionSelect(option);
               optionsContainer.appendChild(button);
           });
           const progressPercentage = ((stageIndex + 1) / simulationData.length) * 100;
           progressBar.style.width = `${progressPercentage}%`;
           progressText.textContent = `Paso ${stageIndex + 1} de ${simulationData.length}`;
           decisionContent.classList.remove('hidden');
           feedbackContent.classList.add('hidden');
           loader.classList.add('hidden');
           nextBtn.classList.add('hidden');
           retryBtn.classList.add('hidden');
       }
       async function handleOptionSelect(option) {
           decisionContent.classList.add('hidden');
           loader.classList.remove('hidden');
           const feedback = await getAIFeedback(simulationData[currentStage], option);
           aiFeedback.innerHTML = feedback;
           loader.classList.add('hidden');
           feedbackContent.classList.remove('hidden');
           if (option.isOptimal) {
               nextBtn.classList.remove('hidden');
               retryBtn.classList.add('hidden');
           } else {
               retryBtn.classList.remove('hidden');
               nextBtn.classList.add('hidden');
           }
       }
       function goToNextStage() {
           currentStage++;
           if (currentStage < simulationData.length) {
               renderStage(currentStage);
           } else {
               showEndScreen();
           }
       }
       function retryStage() {
           renderStage(currentStage);
       }
       function showStartScreen() {
           startScreen.classList.remove('hidden');
           simulationScreen.classList.add('hidden');
           endScreen.classList.add('hidden');
       }
       function showSimulationScreen() {
           startScreen.classList.add('hidden');
           simulationScreen.classList.remove('hidden');
           endScreen.classList.add('hidden');
           currentStage = 0;
           renderStage(currentStage);
       }
       function showEndScreen() {
           startScreen.classList.add('hidden');
           simulationScreen.classList.add('hidden');
           endScreen.classList.remove('hidden');
       }
       // --- EVENT LISTENERS E INICIO ---
       startBtn.addEventListener('click', showSimulationScreen);
       restartBtn.addEventListener('click', showSimulationScreen);
       nextBtn.addEventListener('click', goToNextStage);
       retryBtn.addEventListener('click', retryStage);
       // Iniciar la aplicación
       document.addEventListener('DOMContentLoaded', () => {
           setupApiKey();
           showStartScreen();
       });
</script>
</body>
</html>