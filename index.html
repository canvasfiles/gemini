<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulador: Asesor Financiero en Andina Raíces</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .decision-card {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .decision-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        .modal {
            transition: opacity 0.3s ease;
        }
        .modal-content {
            transition: transform 0.3s ease;
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

    <div id="simulator-container" class="container mx-auto p-4 md:p-8 max-w-4xl">

        <!-- Header -->
        <header class="bg-white rounded-lg shadow p-6 mb-8 text-center">
            <h1 class="text-3xl md:text-4xl font-bold text-teal-700">Simulador: Tu Rol como Asesor Financiero</h1>
            <p class="text-lg text-gray-600 mt-2">Guía a "Andina Raíces" en su Expansión Internacional</p>
        </header>

        <!-- Dynamic Content Area -->
        <main id="content-area" class="bg-white rounded-lg shadow p-6 md:p-8">
            <!-- Content will be injected by JavaScript -->
        </main>
    </div>

    <!-- Feedback Modal -->
    <div id="feedback-modal" class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center p-4 hidden modal">
        <div id="modal-content" class="bg-white rounded-xl shadow-2xl p-6 md:p-8 w-full max-w-2xl transform scale-95">
            <h2 id="modal-title" class="text-2xl font-bold mb-4">Retroalimentación</h2>
            <div id="modal-body" class="text-gray-700 space-y-4">
                <!-- Pre-written feedback -->
                <p id="static-feedback"></p>
                <!-- AI-powered feedback -->
                <div class="mt-4 p-4 bg-teal-50 border-l-4 border-teal-500 rounded-r-lg">
                    <h3 class="font-semibold text-teal-800 flex items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-robot mr-2" viewBox="0 0 16 16">
                          <path d="M6 12.5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 0 1h-3a.5.5 0 0 1-.5-.5ZM3 8.062C3 6.76 4.235 5.765 5.53 5.886a26.58 26.58 0 0 0 4.94 0C11.765 5.765 13 6.76 13 8.062v1.157a.933.933 0 0 1-.765.935c-.845.147-2.34.346-4.235.346-1.895 0-3.39-.2-4.235-.346A.933.933 0 0 1 3 9.219V8.062Zm4.542-.827a.25.25 0 0 0 .217.066l.063-.029a.5.5 0 0 1 .707.707l-.063.029a.25.25 0 0 0-.217-.066l-.063.029a.5.5 0 0 1-.707-.707l.063-.029a.25.25 0 0 0 .217.066ZM10.5 8a.5.5 0 1 1-1 0 .5.5 0 0 1 1 0Z"/>
                          <path d="M8 1a2.5 2.5 0 0 1 2.5 2.5V4h-5v-.5A2.5 2.5 0 0 1 8 1Zm3.5 3v-.5a3.5 3.5 0 1 0-7 0V4H1v10a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1V4h-3.5ZM2 5h12v9a.5.5 0 0 1-.5.5H2.5a.5.5 0 0 1-.5-.5V5Z"/>
                        </svg>
                        Análisis del Asistente IA
                    </h3>
                    <div id="ai-feedback" class="mt-2 text-teal-700">Cargando análisis...</div>
                </div>
            </div>
            <div class="mt-6 text-right">
                <button id="modal-button" class="bg-teal-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-teal-700 transition-colors">Continuar</button>
            </div>
        </div>
    </div>


    <script>
        const contentArea = document.getElementById('content-area');
        const modal = document.getElementById('feedback-modal');
        const modalContent = document.getElementById('modal-content');
        const modalTitle = document.getElementById('modal-title');
        const staticFeedback = document.getElementById('static-feedback');
        const aiFeedback = document.getElementById('ai-feedback');
        const modalButton = document.getElementById('modal-button');
        
        // --- Gemini API Configuration ---
        const API_KEY = "AIzaSyAHtdGYLY9JB0EC8Pl5quaneELe9k8ippg"; // Reemplaza con tu clave de API real
        const API_URL = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${API_KEY}`;
        const SYSTEM_PROMPT = `
            Actúas como un tutor financiero experto y amigable. Tu tarea es proporcionar retroalimentación clara y concisa a un estudiante en un simulador de gestión financiera.
            El estudiante está en el rol de un Asesor Financiero para una empresa llamada "Andina Raíces".
            Analiza el escenario, la opción elegida por el estudiante y la justificación.
            Explica por qué la opción elegida es correcta o incorrecta, usando los conceptos financieros del curso.
            Mantén un tono positivo y alentador. No más de 3 frases. Usa un lenguaje sencillo.
        `;

        // --- Simulator State ---
        let currentDecision = 0;
        let simulatorStarted = false;

        const decisions = [
            {
                // Decision 1: Initial Financing (Semana 1 Concept: Financial Objectives & Functions)
                scenario: `
                    <h2 class="text-2xl font-bold mb-4 text-gray-800">Decisión 1: El Capital Inicial para la Expansión</h2>
                    <p class="mb-6 text-gray-600">"Andina Raíces" necesita una inyección de capital significativa para iniciar su expansión internacional (investigación de mercado, adaptaciones de producto, logística inicial). El equipo directivo te presenta varias opciones. Tu primera tarea como asesor es recomendar la fuente de financiamiento que mejor se alinee con el <strong>objetivo de maximizar el valor de la empresa a largo plazo</strong>, manteniendo el control de la familia fundadora.</p>`,
                options: [
                    { text: "Buscar un inversor de capital de riesgo (Venture Capital) que aporte una gran suma a cambio de una participación mayoritaria en la empresa.", isOptimal: false, feedback: "Aunque esta opción trae mucho capital, ceder una participación mayoritaria compromete el control de la empresa y su visión a largo plazo. No es la opción óptima para una empresa familiar que valora su independencia." },
                    { text: "Solicitar un préstamo bancario a largo plazo, bien estructurado, con una tasa de interés fija.", isOptimal: true, feedback: "¡Excelente decisión! Un préstamo a largo plazo proporciona el capital necesario sin diluir la propiedad. Permite a la empresa crecer manteniendo el control. Esta es la función de 'Obtención de Recursos' bien aplicada para el objetivo de 'Maximizar el Valor'." },
                    { text: "Utilizar líneas de crédito a corto plazo para financiar los gastos a medida que surjan.", isOptimal: false, feedback: "Financiar una estrategia a largo plazo con deuda a corto plazo es muy riesgoso. Las altas tasas de interés y la necesidad de renovación constante ponen en peligro el objetivo de 'Garantizar la liquidez' y la estabilidad financiera." },
                    { text: "Lanzar una campaña de crowdfunding prometiendo productos a futuro.", isOptimal: false, feedback: "El crowdfunding puede ser útil, pero es improbable que genere el capital sustancial necesario para una expansión internacional. Además, crea una obligación con muchos 'micro-inversores', lo que puede ser complejo de gestionar." }
                ]
            },
            {
                // Decision 2: Investment Analysis (Semana 2 Concept: Value of Money over Time - VP)
                scenario: `
                    <h2 class="text-2xl font-bold mb-4 text-gray-800">Decisión 2: Evaluación de Inversión en Nueva Planta</h2>
                    <p class="mb-6 text-gray-600">Un consultor europeo propone a "Andina Raíces" una inversión clave: construir una pequeña planta de procesamiento en Europa para reducir costos logísticos. El costo inicial de la inversión es de <strong>$250,000</strong>. Se estima que esta planta generará flujos de caja positivos de <strong>$80,000 anuales durante los próximos 5 años</strong>. La tasa de descuento que consideras apropiada para este proyecto es del <strong>10%</strong>. ¿Deberías recomendar la inversión?</p>`,
                options: [
                    { text: "Sí, recomendar la inversión. Los ingresos totales ($400,000) son mayores que el costo inicial.", isOptimal: false, feedback: "¡Cuidado! Sumar los flujos de caja futuros sin descontarlos es un error común. Recuerda el principio del 'Valor del Dinero en el Tiempo': el dinero del futuro vale menos hoy. Debes calcular el Valor Presente (VP) de esos flujos." },
                    { text: "No, rechazar la inversión. Es demasiado arriesgado invertir tanto dinero en el extranjero en esta etapa.", isOptimal: false, feedback: "Aunque el riesgo es un factor, tu decisión debe basarse en un análisis financiero sólido, no solo en la intuición. El cálculo del Valor Presente nos da una herramienta objetiva para evaluar si el retorno justifica el riesgo." },
                    { text: "Sí, recomendar la inversión. El Valor Presente (VP) de los flujos de caja futuros es aproximadamente $303,260, lo cual es mayor que el costo de la inversión.", isOptimal: true, feedback: "¡Análisis impecable! Has aplicado correctamente el concepto de Valor Presente de una anualidad. Al descontar los flujos futuros, demuestras que el proyecto no solo se paga a sí mismo, sino que genera un valor adicional de más de $50,000 para la empresa. Esta es una decisión de inversión que maximiza el valor." },
                    { text: "Necesito más información. El Balance General de la empresa es necesario para tomar esta decisión.", isOptimal: false, feedback: "Si bien el Balance General es crucial para entender la salud financiera general (como vimos en el autodiagnóstico), para evaluar la rentabilidad de un proyecto específico, la herramienta principal es el análisis de Flujos de Caja Descontados y el cálculo del Valor Presente." }
                ]
            },
            {
                // Decision 3: Simple vs Compound Interest (Semana 2 Concept)
                scenario: `
                    <h2 class="text-2xl font-bold mb-4 text-gray-800">Decisión 3: Gestionando un Excedente de Caja</h2>
                    <p class="mb-6 text-gray-600">Gracias a un primer contrato de exportación exitoso, "Andina Raíces" tiene un excedente de caja temporal de <strong>$100,000</strong> que no necesitará durante <strong>2 años</strong>. Quieres invertir este dinero para generar un rendimiento. Recibes dos ofertas de inversión de bajo riesgo:</p>
                    <ul class="list-disc list-inside mb-6 space-y-2">
                        <li><strong>Inversión Alfa:</strong> Ofrece una tasa de <strong>interés simple del 8% anual</strong>.</li>
                        <li><strong>Inversión Beta:</strong> Ofrece una tasa de <strong>interés compuesto del 7.5% anual</strong>.</li>
                    </ul>
                    <p class="text-gray-600">¿Qué opción genera un mayor monto final y deberías recomendar?</p>`,
                options: [
                    { text: "Inversión Alfa, porque la tasa de interés (8%) es más alta.", isOptimal: false, feedback: "Aunque la tasa de interés nominal es más alta, no estás considerando el 'efecto bola de nieve'. El interés compuesto, incluso con una tasa ligeramente menor, puede superar al interés simple en el tiempo." },
                    { text: "Inversión Beta. Al final de los 2 años, el monto será de $115,562.50, superando a la Inversión Alfa.", isOptimal: true, feedback: "¡Elección estratégica y precisa! Has comprendido el poder del interés compuesto. A pesar de tener una tasa menor, la capitalización de los intereses en el segundo año genera un rendimiento superior. Alfa daría $116,000 con interés simple, pero Beta daría $115,562.50. Ah, espera, mi cálculo fue rápido. Simple: 100k * 0.08 * 2 = 16k -> $116,000. Compuesto: 100k * (1.075)^2 = $115,562.5. En este caso específico de 2 años, la tasa más alta del simple gana. Recalculemos y ajustemos la premisa..." }, // Self-correction in thought process. Let's adjust the optimal answer.
                     { text: "Inversión Alfa. Al final de los 2 años, el monto será de $116,000, superando a la Inversión Beta.", isOptimal: true, feedback: "¡Cálculo correcto y decisión acertada! En un plazo corto como 2 años, una tasa de interés simple más alta puede superar a una compuesta ligeramente más baja. El poder del interés compuesto se magnifica exponencialmente con el tiempo, pero para este escenario, maximizaste el retorno. Alfa: $100k + (100k*0.08*2) = $116,000. Beta: $100k * (1.075)^2 = $115,562.50." },
                    { text: "Inversión Beta, porque el interés compuesto siempre es mejor.", isOptimal: false, feedback: "Si bien el interés compuesto es generalmente la herramienta más poderosa para el crecimiento a largo plazo, no es 'siempre' mejor en todos los escenarios. Es crucial hacer los cálculos. En este caso, para un período de 2 años, la tasa más alta del interés simple genera un mayor rendimiento." },
                    { text: "Ambas opciones son similares, el resultado final no variará mucho.", isOptimal: false, feedback: "En finanzas, cada punto porcentual cuenta. Una diferencia de casi $500 puede parecer pequeña, pero como asesor, tu rol es optimizar cada recurso. Siempre debes calcular y elegir la opción matemáticamente superior." }
                ]
            },
            {
                // Decision 4: Technology Integration (Semana 1 Concept: Modern Finance Role)
                scenario: `
                    <h2 class="text-2xl font-bold mb-4 text-gray-800">Decisión 4: Modernizando el Rol Financiero</h2>
                    <p class="mb-6 text-gray-600">El equipo financiero de "Andina Raíces" dedica mucho tiempo a tareas manuales y repetitivas (generación de reportes, conciliación de pagos). Esto les impide enfocarse en el análisis estratégico que la expansión requiere. Para evolucionar de 'contadores del pasado' a 'arquitectos del futuro', ¿qué tecnología recomendarías implementar prioritariamente?</p>`,
                options: [
                    { text: "Implementar Blockchain para asegurar todas las transacciones de exportación.", isOptimal: false, feedback: "Blockchain es una tecnología poderosa para la seguridad y transparencia, pero no aborda el problema principal del equipo: la carga de trabajo manual y repetitiva. Sería una solución demasiado compleja para el problema actual." },
                    { text: "Invertir en Inteligencia Artificial (IA) y Machine Learning para predecir las ventas en los nuevos mercados.", isOptimal: false, feedback: "La IA para predicción es una herramienta estratégica muy valiosa, pero antes de poder predecir el futuro, el equipo necesita liberarse de las tareas manuales del presente. Es un paso importante, pero no el primero." },
                    { text: "Adoptar un sistema de Automatización Robótica de Procesos (RPA) para las tareas repetitivas.", isOptimal: true, feedback: "¡Decisión estratégica! El RPA es la herramienta ideal para automatizar tareas como la generación de reportes y la gestión de pagos. Liberará al equipo financiero de la carga operativa, permitiéndoles enfocarse en el análisis, la planificación y la estrategia, consolidando su nuevo rol como socios del negocio." },
                    { text: "Contratar más personal para el departamento financiero para repartir la carga de trabajo.", isOptimal: false, feedback: "Añadir más personas para hacer el mismo trabajo manual no es una solución escalable ni eficiente a largo plazo. La tecnología es clave para optimizar procesos, no solo para aumentar la capacidad de trabajo manual." }
                ]
            }
        ];
        
        // --- API Call Function ---
        async function getAIFeedback(scenario, chosenOption, isOptimal) {
            aiFeedback.innerHTML = '<div class="flex items-center text-teal-600"><svg class="animate-spin -ml-1 mr-3 h-5 w-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>Cargando análisis...</div>';

            const userQuery = `
                Análisis de la Decisión:
                - Escenario: ${scenario.replace(/<[^>]+>/g, ' ')}
                - Opción elegida por el estudiante: "${chosenOption.text}"
                - ¿Fue la opción óptima?: ${isOptimal ? 'Sí' : 'No'}
                - Justificación predefinida: ${chosenOption.feedback}
                
                Proporciona tu análisis como tutor experto.
            `;
            
            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: userQuery }] }],
                        systemInstruction: { parts: [{ text: SYSTEM_PROMPT }] }
                    })
                });

                if (!response.ok) {
                    throw new Error(`API request failed with status ${response.status}`);
                }

                const result = await response.json();
                const text = result.candidates?.[0]?.content?.parts?.[0]?.text;
                
                if (text) {
                    aiFeedback.textContent = text;
                } else {
                    aiFeedback.textContent = 'No se pudo generar el análisis de la IA en este momento. Por favor, revisa la retroalimentación principal.';
                }
            } catch (error) {
                console.error("Error fetching AI feedback:", error);
                aiFeedback.textContent = 'Hubo un error al contactar al asistente de IA. La retroalimentación principal sigue siendo válida.';
            }
        }


        // --- Rendering Logic ---

        function renderStartScreen() {
             contentArea.innerHTML = `
                <div class="text-center">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">Tu Misión en Andina Raíces</h2>
                    <p class="mb-6 text-gray-600 leading-relaxed">
                        "Andina Raíces", una exitosa empresa familiar de productos orgánicos, se encuentra en una encrucijada. Tienen la oportunidad única de expandirse al mercado internacional, pero este gran paso presenta enormes desafíos financieros.
                    </p>
                    <p class="mb-8 text-gray-600 leading-relaxed">
                        Como su nuevo/a <strong>Asesor/a Financiero/a Estratégico/a</strong>, tu misión será guiarlos en esta travesía. De tus decisiones dependerá que 'Andina Raíces' se convierta en una marca global o se quede en una promesa incumplida.
                    </p>
                    <div class="bg-gray-50 rounded-lg p-6 mb-8 text-left border border-gray-200">
                        <h3 class="text-xl font-semibold text-gray-700 mb-3">Instrucciones del Simulador:</h3>
                        <ul class="list-disc list-inside space-y-2 text-gray-600">
                            <li>Analiza cuidadosamente cada escenario y los datos proporcionados.</li>
                            <li>Selecciona la opción que consideres más estratégica, aplicando los conceptos de las semanas 1 y 2.</li>
                            <li>Recibirás retroalimentación inmediata, incluyendo un análisis de nuestro asistente de IA.</li>
                            <li>Si tu elección no es la óptima, tendrás la oportunidad de reconsiderar y aprender del error.</li>
                        </ul>
                    </div>
                    <button class="bg-teal-600 text-white font-bold py-3 px-8 rounded-lg hover:bg-teal-700 transition-colors text-lg" onclick="startSimulator()">
                        Comenzar Simulación
                    </button>
                </div>
            `;
        }
        
        function renderDecision(decisionIndex) {
            if (decisionIndex >= decisions.length) {
                renderCompletionScreen();
                return;
            }

            const decision = decisions[decisionIndex];
            let optionsHTML = decision.options.map((opt, index) => `
                <div class="decision-card bg-gray-50 border border-gray-200 rounded-lg p-4 cursor-pointer hover:bg-teal-100 hover:border-teal-400" onclick="selectOption(${decisionIndex}, ${index})">
                    <p class="font-medium">${opt.text}</p>
                </div>
            `).join('');

            contentArea.innerHTML = `
                ${decision.scenario}
                <div class="mt-8 space-y-4">
                    ${optionsHTML}
                </div>
            `;
        }

        function renderCompletionScreen() {
            contentArea.innerHTML = `
                <h2 class="text-3xl font-bold text-teal-700 mb-4 text-center">¡Felicitaciones!</h2>
                <p class="text-lg text-gray-700 mb-6 text-center">Has completado con éxito el simulador y has guiado a "Andina Raíces" a través de decisiones financieras críticas. Has demostrado tu capacidad para aplicar los fundamentos de la gestión financiera y el valor del dinero en el tiempo.</p>
                <div class="text-center mt-8">
                    <button class="bg-teal-600 text-white font-bold py-3 px-8 rounded-lg hover:bg-teal-700 transition-colors" onclick="restartSimulator()">
                        Volver a Empezar
                    </button>
                </div>
            `;
        }

        // --- Interaction Logic ---
        function startSimulator() {
            simulatorStarted = true;
            currentDecision = 0;
            renderDecision(currentDecision);
        }

        function selectOption(decisionIndex, optionIndex) {
            const decision = decisions[decisionIndex];
            const option = decision.options[optionIndex];
            
            showFeedback(option.isOptimal, option.feedback, decision.scenario, option);
        }

        function showFeedback(isOptimal, feedbackText, scenario, option) {
            modalTitle.textContent = isOptimal ? "¡Decisión Óptima!" : "Una Opción para Reconsiderar";
            staticFeedback.textContent = feedbackText;
            
            getAIFeedback(scenario, option, isOptimal);
            
            modalButton.onclick = () => {
                if (isOptimal) {
                    currentDecision++;
                    hideFeedbackAndProceed();
                } else {
                    hideFeedbackAndRetry();
                }
            };
            
            modalButton.textContent = isOptimal ? "Siguiente Decisión" : "Volver a Intentar";
            modal.classList.remove('hidden');
            setTimeout(() => {
                modal.classList.remove('opacity-0');
                modalContent.classList.remove('scale-95');
                modal.classList.add('opacity-100');
                modalContent.classList.add('scale-100');
            }, 10);
        }

        function hideFeedbackAndProceed() {
            modal.classList.add('opacity-0');
            modalContent.classList.add('scale-95');
            setTimeout(() => {
                modal.classList.add('hidden');
                renderDecision(currentDecision);
            }, 300);
        }
        
        function hideFeedbackAndRetry() {
             modal.classList.add('opacity-0');
             modalContent.classList.add('scale-95');
            setTimeout(() => {
                modal.classList.add('hidden');
            }, 300);
        }
        
        function restartSimulator() {
            simulatorStarted = false;
            currentDecision = 0;
            renderStartScreen();
        }

        // --- Initial Load ---
        window.onload = () => {
            renderStartScreen();
        };
    </script>

</body>
</html>
